"use strict";(self["webpackChunkschool_canteen"]=self["webpackChunkschool_canteen"]||[]).push([[159],{4159:function(t,s,e){e.r(s),e.d(s,{default:function(){return l}});var a=function(){var t=this,s=t._self._c;return s("div",[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isPay,expression:"!isPay"}],staticClass:"one"},[s("div",{staticClass:"header"},[t._v(t._s(t.foodDetail.sname))]),s("div",{staticClass:"body"},[s("div",{staticClass:"foodPic"},[s("img",{staticStyle:{width:"100%"},attrs:{src:t.foodDetail.dimage}})]),s("div",{staticClass:"foodInfo"},[s("div",{staticClass:"infoItem"},[t._v(" 菜品名称: "),s("span",{staticClass:"text"},[t._v(t._s(t.foodDetail.dname))])]),s("div",{staticClass:"infoItem"},[t._v(" 菜品价格: "),s("span",{staticClass:"text"},[t._v(" "+t._s(t.foodDetail.dprice)+".00")])]),s("div",{staticClass:"infoItem"},[t._v(" 菜品数量:"),s("el-input-number",{ref:"counter",attrs:{min:1,max:20},on:{blur:t.handleChange},model:{value:t.num,callback:function(s){t.num=s},expression:"num"}})],1),s("div",{staticClass:"infoBtn"},[s("button",{staticClass:"addCart",on:{click:t.addShopCart}},[t._v("添加到购物车")]),s("button",{staticClass:"payNow",on:{click:function(s){t.isPay=!0}}},[t._v("立即支付")])])])]),s("div",{ref:"footer",staticClass:"footer"},[s("div",{staticClass:"Ftitle"},[s("button",{class:t.isComments?"detailBtn":"detailBtn activeBtn ",on:{click:function(s){return t.choseOne(1)}}},[t._v(" 菜品详情 ")]),s("button",{class:t.isComments?"commentsBtn activeBtn ":"commentsBtn",on:{click:function(s){return t.choseOne(2)}}},[t._v(" 用户评论 ")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.isComments,expression:"!isComments"}],staticClass:"info"},[s("div",{staticClass:"infoDetail"},[t._v(t._s(t.foodDetail.detail))])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isComments,expression:"isComments"}],staticClass:"comments"},[s("div",{staticClass:"saySome"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.myComment,expression:"myComment"}],staticClass:"myComment",attrs:{cols:"90",rows:"3",placeholder:"请输入100字以内的评论。"},domProps:{value:t.myComment},on:{input:function(s){s.target.composing||(t.myComment=s.target.value)}}}),s("button",{directives:[{name:"show",rawName:"v-show",value:0!=t.myComment.length,expression:"myComment.length != 0"}],staticClass:"uploadComment",on:{click:t.addComments}},[t._v(" 发表评论 ")])]),s("div",{staticClass:"commentsTable"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:t.userComments,stripe:!0,height:"100%"}},[s("el-table-column",{attrs:{prop:"date",label:"日期",width:"150",align:"center"}}),s("el-table-column",{attrs:{prop:"uname",label:"用户",width:"100",align:"center"}}),s("el-table-column",{attrs:{prop:"detail",label:"评论",align:"center"}})],1)],1),s("div",{staticClass:"commentsPagination"},[s("el-pagination",{attrs:{"current-page":t.pagenum,total:t.total,"page-size":7,background:"",layout:"total, prev, pager, next, jumper"},on:{"current-change":t.pagenumChange,"update:currentPage":function(s){t.pagenum=s},"update:current-page":function(s){t.pagenum=s}}})],1)])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.isPay,expression:"isPay"}],staticClass:"two"},[s("el-result",{attrs:{title:"请使用支付宝支付"}},[s("template",{slot:"icon"},[s("img",{staticClass:"payIcon",attrs:{src:e(380)}})]),s("template",{slot:"extra"},[s("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.payNow}},[t._v("确认支付")])],1)],2)],1)])},i=[],o=e(586),n={name:"food",data(){return{foodID:"",shopID:"",foodDetail:{},pagenum:1,num:1,isComments:!1,myComment:"",total:0,userComments:[],isPay:!1}},methods:{handleChange(t){"undefined"==t.target.ariaValueNow&&(this.$message.warning("请输入菜品数量"),this.$refs.counter.focus())},choseOne(t){1==t?this.isComments=!1:2==t&&(this.isComments=!0)},payNow(){this.createOrderFn(),this.isPay=!1},async createOrderFn(){const{data:t}=await(0,o.gh)({did:this.foodID,sid:this.shopID,count:this.num});if(console.log(t),0!=t.code)return this.$message.error("支付出现问题！请联系管理员！");this.$message.success("购买成功！")},async initFoodDetail(){const{data:t}=await(0,o.Mj)(this.foodID);if(0!==t.code)return this.$message.error("Sorry! There is something wrong!");console.log(t),this.foodDetail=t.data,this.shopID=t.data.sid},async initcommentsList(){const{data:t}=await(0,o.iQ)({foodID:this.foodID,pagenum:this.pagenum});if(0!==t.code)return this.$message.error("Sorry! There is something wrong!");console.log(t),this.userComments=t.data.comments,this.userComments.forEach((t=>{t.date=this.myDateFormat(t.date)})),this.total=t.data.total},async addComments(){const{data:t}=await(0,o.hE)({shopID:this.foodDetail.sid,foodID:this.foodDetail.did,comments:this.myComment});if(0!==t.code)return this.$message.error("评论是失败！");this.$message.success("评论成功"),this.initcommentsList(),this.myComment=""},pagenumChange(t){this.pagenum=t,this.initcommentsList()},async addShopCart(){const{data:t}=await(0,o.kF)({did:this.foodID,sid:this.shopID,count:this.num});if(0!==t.code)return this.$message.error(t.message);this.$message.success(t.message),this.num=1}},created(){this.foodID=this.$route.query.foodID,this.initFoodDetail(),this.initcommentsList()},mounted(){}},m=n,r=e(1001),c=(0,r.Z)(m,a,i,!1,null,"066a0880",null),l=c.exports},380:function(t,s,e){t.exports=e.p+"img/ZFB.9ce72c62.png"}}]);
//# sourceMappingURL=159.6132543e.js.map