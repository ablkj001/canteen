(self["webpackChunkschool_canteen"]=self["webpackChunkschool_canteen"]||[]).push([[277],{5519:function(t,e,a){"use strict";a.r(e),a.d(e,{default:function(){return f}});var s=function(){var t=this,e=t._self._c;return e("div",[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isPay,expression:"!isPay"}],staticClass:"cart"},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("购物车")])]),e("div",{staticClass:"cart-main"},[e("div",{staticClass:"cart-th"},[e("div",{staticClass:"cart-th1"},[t._v("全部")]),e("div",{staticClass:"cart-th2"},[t._v("商品")]),e("div",{staticClass:"cart-th3"},[t._v("单价（元）")]),e("div",{staticClass:"cart-th4"},[t._v("数量")]),e("div",{staticClass:"cart-th5"},[t._v("小计（元）")]),e("div",{staticClass:"cart-th6"},[t._v("操作")])]),e("div",{staticClass:"cart-body"},t._l(t.cartInfoList,(function(a){return e("ul",{key:a.id,staticClass:"cart-list"},[e("li",{staticClass:"cart-list-con1"},[e("input",{attrs:{type:"checkbox",name:"chk_list"},domProps:{checked:0==a.status},on:{change:function(e){return t.updateChecked(a,e)}}})]),e("li",{staticClass:"cart-list-con2"},[e("img",{attrs:{src:a.dimage}}),e("div",{staticClass:"msg"},[e("div",{staticClass:"shopname"},[t._v(t._s(a.sname))]),e("div",{staticClass:"item-msg"},[t._v(" "+t._s(a.dname)+" ")])]),0==a.dstatus?e("el-button",{attrs:{type:"success",disabled:""}},[t._v(" 在售 ")]):e("el-button",{attrs:{type:"info",disabled:""}},[t._v(" 待售 ")])],1),e("li",{staticClass:"cart-list-con4"},[e("span",{staticClass:"price"},[t._v(t._s(a.dprice))])]),e("li",{staticClass:"cart-list-con5"},[e("a",{staticClass:"mins",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.handler("mins",-1,a)}}},[t._v(" - ")]),e("input",{staticClass:"itxt",attrs:{autocomplete:"off",type:"text",minnum:"1"},domProps:{value:a.count},on:{change:function(e){return t.handler("change",1*e.target.value,a)}}}),e("a",{staticClass:"plus",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.handler("add",1,a)}}},[t._v("+")])]),e("li",{staticClass:"cart-list-con6"},[e("span",{staticClass:"sum"},[t._v(t._s(a.count*a.dprice))])]),e("li",{staticClass:"cart-list-con7"},[e("el-button",{staticClass:"sindelet",attrs:{type:"danger"},on:{click:function(e){return t.deleteButtonONE(a)}}},[t._v("删除")])],1)])})),0)]),e("div",{staticClass:"cart-tool"},[e("div",{staticClass:"select-all"},[e("input",{staticClass:"chooseAll",attrs:{type:"checkbox",disabled:0==t.cartInfoList.length},domProps:{checked:t.isAllChecked&&t.cartInfoList.length>0},on:{change:t.updateAllCartChecked}}),e("span",[t._v("全选")])]),e("div",{staticClass:"option"},[e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:t.deleteButtonTWO}},[t._v(" 删除选中的菜品 ")]),e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:t.deleteAllForsaleCart}},[t._v("清除下架菜品")])],1),e("div",{staticClass:"money-box"},[e("div",{staticClass:"chosed"},[t._v(" 已选择 "),e("span",[t._v(t._s(t.chosedNum))]),t._v("件菜品 ")]),e("div",{staticClass:"sumprice"},[e("em",[t._v("总价 ：")]),e("i",{staticClass:"summoney"},[t._v(t._s(t.totalPrice))])]),e("div",{staticClass:"sumbtn"},[e("a",{staticClass:"sum-btn",staticStyle:{cursor:"pointer"},on:{click:t.calculate}},[t._v("结算")])])])])])],1),e("div",{directives:[{name:"show",rawName:"v-show",value:t.isPay,expression:"isPay"}],staticClass:"two"},[e("el-result",{attrs:{title:"请使用支付宝支付"}},[e("template",{slot:"icon"},[e("img",{staticClass:"payIcon",attrs:{src:a(380)}})]),e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"medium"},on:{click:t.payNow}},[t._v("确认支付")])],1)],2)],1)])},i=[],c=a(9289),n=a.n(c),r=a(3822),o=a(586),l={name:"shopcart",data(){return{isPay:!1}},methods:{getData(){this.$store.dispatch("getCartList")},handler:n()((async function(t,e,a){switch(t){case"add":e=1;break;case"mins":e=a.count>1?-1:0;break;case"change":if(isNaN(e)||e<0)e=0;else{if(parseInt(e)>20)return this.$message.error("您已超过最大限购数量！"),this.getData();e=parseInt(e)-a.skuNum}break}try{await this.$store.dispatch("updateShopCart",{cartID:a.carid,num:e}),this.getData()}catch(s){alert(s.message)}}),10),async deleteButtonONE(t){const e=await this.$confirm("此操作将永久删除该记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((t=>t));"cancel"!==e&&this.deleteCartById(t)},async deleteCartById(t){try{await this.$store.dispatch("deleteCartListBySkuId",t.carid),this.getData()}catch(e){alert(e.message)}},async updateChecked(t,e){try{let a=e.target.checked?"0":"1";await this.$store.dispatch("updateCheckedById",{cartID:t.carid,isChecked:a}),this.getData()}catch(a){alert(a.message)}},async deleteButtonTWO(){const t=await this.$confirm("此操作将永久删除勾选记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((t=>t));"cancel"!==t&&this.deleteAllCheckedCart()},async deleteAllCheckedCart(){try{await this.$store.dispatch("deleteAllCheckedCart"),this.getData()}catch(t){alert(t.message)}},async deleteAllForsaleCart(){try{await this.$store.dispatch("deleteAllForsaleCart"),this.getData()}catch(t){alert(t.message)}},async updateAllCartChecked(t){try{let e=t.target.checked?"0":"1";await this.$store.dispatch("updateAllCartChecked",e),this.getData()}catch(e){alert(e.message)}},calculate(){this.isPay=!0},payNow(){this.calculateFn(),this.isPay=!1},async calculateFn(){const{data:t}=await(0,o.YL)();if(0!=t.code)return this.$message.error("支付失败！");this.$message.success("购买成功！"),this.getData()}},mounted(){this.getData()},computed:{...(0,r.Se)(["cartList"]),cartInfoList(){return this.cartList||[]},totalPrice(){let t=0;return this.cartInfoList.forEach((e=>{0==e.status&&(t+=e.dprice*e.count)})),t},isAllChecked(){return this.cartInfoList.every((t=>0==t.status))},chosedNum(){let t=0;return this.cartInfoList.forEach((e=>{0==e.status&&t++})),t}}},u=l,d=a(1001),h=(0,d.Z)(u,s,i,!1,null,"3973eafa",null),f=h.exports},9016:function(t,e,a){var s=a(9159),i=s.Symbol;t.exports=i},6423:function(t,e,a){var s=a(9016),i=a(2366),c=a(2886),n="[object Null]",r="[object Undefined]",o=s?s.toStringTag:void 0;function l(t){return null==t?void 0===t?r:n:o&&o in Object(t)?i(t):c(t)}t.exports=l},6009:function(t,e,a){var s=a(1626),i=/^\s+/;function c(t){return t?t.slice(0,s(t)+1).replace(i,""):t}t.exports=c},791:function(t,e,a){var s="object"==typeof a.g&&a.g&&a.g.Object===Object&&a.g;t.exports=s},2366:function(t,e,a){var s=a(9016),i=Object.prototype,c=i.hasOwnProperty,n=i.toString,r=s?s.toStringTag:void 0;function o(t){var e=c.call(t,r),a=t[r];try{t[r]=void 0;var s=!0}catch(o){}var i=n.call(t);return s&&(e?t[r]=a:delete t[r]),i}t.exports=o},2886:function(t){var e=Object.prototype,a=e.toString;function s(t){return a.call(t)}t.exports=s},9159:function(t,e,a){var s=a(791),i="object"==typeof self&&self&&self.Object===Object&&self,c=s||i||Function("return this")();t.exports=c},1626:function(t){var e=/\s/;function a(t){var a=t.length;while(a--&&e.test(t.charAt(a)));return a}t.exports=a},3738:function(t,e,a){var s=a(150),i=a(657),c=a(2012),n="Expected a function",r=Math.max,o=Math.min;function l(t,e,a){var l,u,d,h,f,p,v=0,m=!1,C=!1,y=!0;if("function"!=typeof t)throw new TypeError(n);function g(e){var a=l,s=u;return l=u=void 0,v=e,h=t.apply(s,a),h}function b(t){return v=t,f=setTimeout(k,e),m?g(t):h}function x(t){var a=t-p,s=t-v,i=e-a;return C?o(i,d-s):i}function _(t){var a=t-p,s=t-v;return void 0===p||a>=e||a<0||C&&s>=d}function k(){var t=i();if(_(t))return w(t);f=setTimeout(k,x(t))}function w(t){return f=void 0,y&&l?g(t):(l=u=void 0,h)}function I(){void 0!==f&&clearTimeout(f),v=0,l=p=u=f=void 0}function j(){return void 0===f?h:w(i())}function T(){var t=i(),a=_(t);if(l=arguments,u=this,p=t,a){if(void 0===f)return b(p);if(C)return clearTimeout(f),f=setTimeout(k,e),g(p)}return void 0===f&&(f=setTimeout(k,e)),h}return e=c(e)||0,s(a)&&(m=!!a.leading,C="maxWait"in a,d=C?r(c(a.maxWait)||0,e):d,y="trailing"in a?!!a.trailing:y),T.cancel=I,T.flush=j,T}t.exports=l},150:function(t){function e(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}t.exports=e},4430:function(t){function e(t){return null!=t&&"object"==typeof t}t.exports=e},7691:function(t,e,a){var s=a(6423),i=a(4430),c="[object Symbol]";function n(t){return"symbol"==typeof t||i(t)&&s(t)==c}t.exports=n},657:function(t,e,a){var s=a(9159),i=function(){return s.Date.now()};t.exports=i},9289:function(t,e,a){var s=a(3738),i=a(150),c="Expected a function";function n(t,e,a){var n=!0,r=!0;if("function"!=typeof t)throw new TypeError(c);return i(a)&&(n="leading"in a?!!a.leading:n,r="trailing"in a?!!a.trailing:r),s(t,e,{leading:n,maxWait:e,trailing:r})}t.exports=n},2012:function(t,e,a){var s=a(6009),i=a(150),c=a(7691),n=NaN,r=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,l=/^0o[0-7]+$/i,u=parseInt;function d(t){if("number"==typeof t)return t;if(c(t))return n;if(i(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=i(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=s(t);var a=o.test(t);return a||l.test(t)?u(t.slice(2),a?2:8):r.test(t)?n:+t}t.exports=d},380:function(t,e,a){"use strict";t.exports=a.p+"img/ZFB.9ce72c62.png"}}]);
//# sourceMappingURL=277.2257fe24.js.map